<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="api.js"></script>
    <script src="webSocket.js"></script>
</head>
<body>
<form id="from" onsubmit="sendData()">
    <input id="input" type="text" placeholder="Write something...">
    <input id="file-input" type="file">
    <input type="submit">
</form>
<div id="status"></div>
<ul id="categories">
</ul>
</body>

<script>

    choseUpdater();

    /**
     *Method for sending data (string or file)
     */
    async function sendData() {

        event.preventDefault()

        const inputElement = document.getElementById("input")
        const input = inputElement.value

        const fileInput = document.getElementById("file-input").files[0]
        const formData = new FormData()

        if (fileInput !== undefined){
            formData.append("file", fileInput)
        }
        //sending a post request to the server with data
        await API.sendData(fileInput === undefined ? input : formData)
    }

    /**
     *Method for update categories
     */
    function choseUpdater(bolChose) {
        if (bolChose) {
            //start WebSocket
            webSocketStart()
        } else {
            showCategories()
            //call the methods showCategory every three seconds
            setInterval(showCategories, 3000)
        }
    }

    /**
     * Method for getting all categories
     */
    async function showCategories() {

        //sending a get request to the server
        const json = await API.getData()
        const catElement = document.getElementById("categories")
        catElement.innerHTML = ""//get categories and create a list of category
        for (let category of json) {
            const elem = document.createElement("li")
            const a = document.createElement("a")
            a.dataset.id = category.id
            a.innerText = category.title
            a.href = '#'
                //on click on category, the data is downloaded
                a.onclick = await function (){
                    downloadCategory(urlCore + '/category/' + category.id)
                };
            elem.appendChild(a)
            catElement.appendChild(elem)
        }
    }

    //call the methods checkCookie every one second
    setInterval(checkCookie, 1000)

</script>
</html>